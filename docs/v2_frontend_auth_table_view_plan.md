# Technical Execution Plan: Authentication Flow & Submissions Table View

## Context

The African Bamboo Dashboard frontend is a fresh Next.js 15 scaffold with no components, contexts, or auth logic. The backend already provides a complete API: KoboToolbox-based JWT authentication (`POST /api/v1/auth/login`), user profile (`GET /api/v1/users/me`), and paginated submissions (`GET /api/v1/odk/submissions/`). The frontend needs a Login page and a data-centric Dashboard with a Submissions table, matching the provided design mockups. This plan uses shadcn/ui components (Radix UI primitives + Tailwind CSS) for a modular, accessible architecture.

**Design references:**
- `docs/assets/dashboard-and-submissions-table-view/main page.jpg` — Dashboard with sidebar, stats cards, filters, data table
- `docs/assets/dashboard-and-submissions-table-view/Sidebar navigation.png` — Collapsible dark sidebar (expanded + collapsed states)
- `docs/assets/dashboard-and-submissions-table-view/african-bamboo-logo-inverse.svg` — Logo for sidebar

---

## Phase 1: Foundation — shadcn/ui Setup & Theming

### 1.1 Install shadcn/ui + dependencies

```bash
cd frontend
npx shadcn@latest init    # Select: JS, App Router, src/ directory, @/ alias
```

This creates:
- `components.json` — shadcn/ui config
- `src/lib/utils.js` — `cn()` utility (clsx + tailwind-merge)

Additional dependencies installed automatically: `clsx`, `tailwind-merge`, `class-variance-authority`, `lucide-react`, `@radix-ui/react-slot`.

### 1.2 Install required shadcn/ui components

```bash
npx shadcn@latest add button input label card badge tabs table \
  dropdown-menu select separator skeleton tooltip avatar sheet
```

### 1.3 Configure Tailwind CSS v4 theming

**File: `frontend/src/app/globals.css`** — Replace with shadcn/ui CSS variable system adapted for Tailwind v4:

```css
@import "tailwindcss";

@custom-variant dark (&:is(.dark *));

:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --card: 0 0% 100%;
  --card-foreground: 222.2 84% 4.9%;
  --primary: 45 93% 47%;          /* Gold/yellow #EAB308 */
  --primary-foreground: 0 0% 0%;
  --secondary: 210 40% 96%;
  --secondary-foreground: 222.2 47% 11%;
  --muted: 210 40% 96%;
  --muted-foreground: 215.4 16% 47%;
  --accent: 210 40% 96%;
  --accent-foreground: 222.2 47% 11%;
  --destructive: 0 84% 60%;
  --destructive-foreground: 0 0% 98%;
  --border: 214.3 32% 91%;
  --input: 214.3 32% 91%;
  --ring: 45 93% 47%;
  --radius: 0.5rem;
  --sidebar-background: 0 0% 10%;       /* #1a1a1a */
  --sidebar-foreground: 0 0% 100%;
  --sidebar-accent: 0 0% 18%;
  --sidebar-accent-foreground: 0 0% 100%;
  --sidebar-border: 0 0% 20%;
  --sidebar-ring: 45 93% 47%;
  /* Status badge colors */
  --status-approved: 142 76% 36%;
  --status-on-hold: 45 93% 47%;
  --status-rejected: 0 84% 60%;
}

@theme inline {
  --color-background: hsl(var(--background));
  --color-foreground: hsl(var(--foreground));
  --color-card: hsl(var(--card));
  --color-card-foreground: hsl(var(--card-foreground));
  --color-primary: hsl(var(--primary));
  --color-primary-foreground: hsl(var(--primary-foreground));
  --color-secondary: hsl(var(--secondary));
  --color-secondary-foreground: hsl(var(--secondary-foreground));
  --color-muted: hsl(var(--muted));
  --color-muted-foreground: hsl(var(--muted-foreground));
  --color-accent: hsl(var(--accent));
  --color-accent-foreground: hsl(var(--accent-foreground));
  --color-destructive: hsl(var(--destructive));
  --color-destructive-foreground: hsl(var(--destructive-foreground));
  --color-border: hsl(var(--border));
  --color-input: hsl(var(--input));
  --color-ring: hsl(var(--ring));
  --color-sidebar-background: hsl(var(--sidebar-background));
  --color-sidebar-foreground: hsl(var(--sidebar-foreground));
  --color-sidebar-accent: hsl(var(--sidebar-accent));
  --color-sidebar-accent-foreground: hsl(var(--sidebar-accent-foreground));
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

body {
  background: hsl(var(--background));
  color: hsl(var(--foreground));
}
```

### 1.4 Move logo to public assets

Copy `docs/assets/dashboard-and-submissions-table-view/african-bamboo-logo-inverse.svg` to `frontend/public/logo.svg`.

**Files created/modified in Phase 1:**
- `frontend/components.json` (generated by CLI)
- `frontend/src/lib/utils.js` (generated by CLI)
- `frontend/src/components/ui/*.js` (generated by CLI — button, input, label, card, badge, tabs, table, dropdown-menu, select, separator, skeleton, tooltip, avatar, sheet)
- `frontend/src/app/globals.css` (modified)
- `frontend/public/logo.svg` (copied)

---

## Phase 2: Auth Infrastructure — jose Sessions, Server Actions, Middleware

### 2.1 Install dependencies

```bash
cd frontend
yarn add jose server-only
```

### 2.2 Session library with jose (encrypt/decrypt)

**File: `frontend/src/lib/session.js`**

Uses `jose` (SignJWT, jwtVerify) for stateless session management following the [official Next.js auth guide](https://nextjs.org/docs/app/guides/authentication). The session cookie wraps the backend JWT token + user data in a server-side encrypted cookie.

```js
import "server-only";
import { SignJWT, jwtVerify } from "jose";
import { cookies } from "next/headers";

const secretKey = process.env.SESSION_SECRET;
const encodedKey = new TextEncoder().encode(secretKey);

// Encrypt session payload into a signed JWT
export async function encrypt(payload) {
  return new SignJWT(payload)
    .setProtectedHeader({ alg: "HS256" })
    .setIssuedAt()
    .setExpirationTime("12h")
    .sign(encodedKey);
}

// Decrypt and verify session JWT
export async function decrypt(session) {
  try {
    const { payload } = await jwtVerify(session, encodedKey, {
      algorithms: ["HS256"],
    });
    return payload;
  } catch (error) {
    console.log("Failed to verify session");
    return null;
  }
}

// Create session cookie after successful login
export async function createSession({ user, token, expirationTime }) {
  const expiresAt = new Date(expirationTime);
  const session = await encrypt({ user, token, expiresAt: expiresAt.toISOString() });
  const cookieStore = await cookies();

  cookieStore.set("session", session, {
    httpOnly: true,
    secure: process.env.NODE_ENV === "production",
    expires: expiresAt,
    sameSite: "lax",
    path: "/",
  });
}

// Update session expiry (extend on activity)
export async function updateSession() {
  const cookieStore = await cookies();
  const session = cookieStore.get("session")?.value;
  const payload = await decrypt(session);
  if (!session || !payload) return null;

  const expires = new Date(Date.now() + 12 * 60 * 60 * 1000);
  cookieStore.set("session", session, {
    httpOnly: true,
    secure: process.env.NODE_ENV === "production",
    expires,
    sameSite: "lax",
    path: "/",
  });
}

// Delete session (logout)
export async function deleteSession() {
  const cookieStore = await cookies();
  cookieStore.delete("session");
}
```

**Environment variable required:** Add `SESSION_SECRET` to `.env`:
```bash
# Generate: openssl rand -base64 32
SESSION_SECRET=your_secret_key_here
```

### 2.3 Server Actions for auth

**File: `frontend/src/app/actions/auth.js`**

Server Actions handle login/logout securely on the server side — credentials never touch client JS.

```js
"use server";
import { redirect } from "next/navigation";
import { createSession, deleteSession } from "@/lib/session";

export async function login(prevState, formData) {
  const koboUrl = formData.get("kobo_url");
  const koboUsername = formData.get("kobo_username");
  const koboPassword = formData.get("kobo_password");

  // Call backend auth API (server-to-server, no CORS issues)
  const res = await fetch("http://backend:8000/api/v1/auth/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      kobo_url: koboUrl,
      kobo_username: koboUsername,
      kobo_password: koboPassword,
    }),
  });

  if (!res.ok) {
    const data = await res.json().catch(() => ({}));
    return { error: data.message || "Invalid KoboToolbox credentials" };
  }

  const data = await res.json();

  // Create encrypted session cookie with user + backend JWT token
  await createSession({
    user: data.user,
    token: data.token,
    expirationTime: data.expiration_time,
  });

  redirect("/dashboard");
}

export async function logout() {
  await deleteSession();
  redirect("/login");
}
```

### 2.4 Data Access Layer (DAL)

**File: `frontend/src/lib/dal.js`**

Centralizes session verification for server components and server-side data fetching. Uses React `cache` to deduplicate within a render pass.

```js
import "server-only";
import { cache } from "react";
import { cookies } from "next/headers";
import { redirect } from "next/navigation";
import { decrypt } from "@/lib/session";

// Verify session and return user + token (server-side only)
export const verifySession = cache(async () => {
  const cookieStore = await cookies();
  const session = cookieStore.get("session")?.value;
  const payload = await decrypt(session);

  if (!payload?.user) {
    redirect("/login");
  }

  return { user: payload.user, token: payload.token };
});
```

### 2.5 Middleware for route protection

**File: `frontend/src/middleware.js`**

Optimistic cookie check — redirects unauthenticated users away from protected routes and authenticated users away from login. Uses `jose` decrypt (Edge-compatible).

```js
import { NextResponse } from "next/server";
import { decrypt } from "@/lib/session";

const protectedRoutes = ["/dashboard"];
const publicRoutes = ["/login"];

export default async function middleware(req) {
  const path = req.nextUrl.pathname;
  const isProtected = protectedRoutes.some((r) => path.startsWith(r));
  const isPublic = publicRoutes.includes(path);

  const session = req.cookies.get("session")?.value;
  const payload = await decrypt(session);

  if (isProtected && !payload?.user) {
    return NextResponse.redirect(new URL("/login", req.nextUrl));
  }

  if (isPublic && payload?.user) {
    return NextResponse.redirect(new URL("/dashboard", req.nextUrl));
  }

  return NextResponse.next();
}

export const config = {
  matcher: ["/((?!api|_next/static|_next/image|.*\\.png$|.*\\.svg$|.*\\.ico$).*)"],
};
```

### 2.6 Axios API client (for client-side data fetching)

**File: `frontend/src/lib/api.js`**

For client components that need to fetch data (submissions, forms), use axios with the backend JWT token. The token is passed from server → client via a context provider.

```js
import axios from "axios";

const api = axios.create({ baseURL: "/api" });

// Set auth token dynamically (called from context provider)
export function setApiToken(token) {
  if (token) {
    api.defaults.headers.common["Authorization"] = `Bearer ${token}`;
  } else {
    delete api.defaults.headers.common["Authorization"];
  }
}

// Response interceptor: handle 401
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      window.location.href = "/login";
    }
    return Promise.reject(error);
  }
);

export default api;
```

### 2.7 Auth context (client-side user state)

**File: `frontend/src/context/AuthContext.js`**

Thin client-side context that receives user + token from server and provides them to child client components. Does NOT handle login (that's a Server Action).

```
AuthProvider (client component)
├── Props: { user, token } — passed from server component
├── On mount: call setApiToken(token) to configure axios
├── Provide: { user, token }
└── logout: calls the logout Server Action
```

### 2.8 Custom hooks

**File: `frontend/src/hooks/useAuth.js`**
- Wrapper around `useContext(AuthContext)` with guard

**File: `frontend/src/hooks/useSubmissions.js`**
- Encapsulates submissions data fetching via axios, pagination state, filtering
- Params: `{ assetUid, limit, offset, search }`
- Returns: `{ data, count, isLoading, error, page, setPage, totalPages }`

**File: `frontend/src/hooks/useForms.js`**
- Fetch registered forms list for form selector

**Files created in Phase 2:**
- `frontend/src/lib/session.js`
- `frontend/src/lib/dal.js`
- `frontend/src/lib/api.js`
- `frontend/src/app/actions/auth.js`
- `frontend/src/middleware.js`
- `frontend/src/context/AuthContext.js`
- `frontend/src/hooks/useAuth.js`
- `frontend/src/hooks/useSubmissions.js`
- `frontend/src/hooks/useForms.js`
- `frontend/.env` (SESSION_SECRET)

---

## Phase 3: Login Page

### 3.1 Route & layout

**File: `frontend/src/app/login/page.js`** — Server component shell
**File: `frontend/src/app/login/login-form.js`** — Client component with form logic

### 3.2 Login form component

Uses shadcn/ui: `Card`, `CardHeader`, `CardContent`, `Input`, `Label`, `Button`

```
LoginPage (server component)
└── <div> centered full-screen, light background
    └── Card (max-w-md, centered)
        ├── CardHeader
        │   ├── Logo (african-bamboo-logo, dark version)
        │   ├── Title: "Sign in to your account"
        │   └── Description: "Enter your KoboToolbox credentials"
        └── CardContent
            └── LoginForm (client component)
                ├── Input: KoboToolbox Server URL (name="kobo_url", default: https://kf.kobotoolbox.org)
                ├── Input: Username (name="kobo_username")
                ├── Input: Password (name="kobo_password", type="password")
                ├── Error alert (role="alert", aria-live="polite")
                └── Button: "Sign in" (disabled={pending}, loading state with spinner)
```

### 3.3 Form behavior (Server Action + useActionState)
- Uses React 19 `useActionState` hook with the `login` Server Action from `@/app/actions/auth`
- `<form action={action}>` — native form submission, no `onSubmit`/`preventDefault`
- `pending` state from `useActionState` disables the button and shows spinner
- Server Action validates, calls backend, creates session cookie, redirects to `/dashboard`
- On error: Server Action returns `{ error: "message" }`, displayed via `state?.error`
- KoboToolbox URL field pre-filled with `https://kf.kobotoolbox.org` (editable)

### 3.4 Accessibility
- All inputs have `<Label>` with `htmlFor`
- Error messages use `role="alert"` + `aria-live="polite"`
- Form is keyboard-navigable (Tab through fields → Enter to submit)
- Focus moves to first error field on validation failure
- Password input has show/hide toggle with `aria-label`

**Files created in Phase 3:**
- `frontend/src/app/login/page.js`
- `frontend/src/app/login/login-form.js`

---

## Phase 4: Dashboard Layout — Sidebar & Shell

### 4.1 Dashboard layout with sidebar

**File: `frontend/src/app/dashboard/layout.js`**

This is a **server component** that calls `verifySession()` from the DAL to get user + token, then passes them to a client-side `AuthProvider`.

```
DashboardLayout (server component)
├── verifySession() → { user, token }
├── AuthProvider (client component, receives user + token as props)
│   └── <div className="flex h-screen">
│       ├── AppSidebar (collapsible)
│       └── <main className="flex-1 overflow-auto p-6">
│           {children}
│       </main>
```

### 4.2 Sidebar component

**File: `frontend/src/components/app-sidebar.js`**

Two states matching the mockup:
- **Expanded** (w-60): Logo + text, search input, nav items with labels, bottom items (Support, Settings)
- **Collapsed** (w-16): Logo icon only, nav icons with tooltips, Settings icon at bottom

```
AppSidebar (client component)
├── State: isCollapsed (boolean, toggled via button or responsive breakpoint)
├── <aside> dark background (bg-sidebar-background)
│   ├── SidebarHeader
│   │   └── Logo (full or icon-only based on state)
│   ├── SidebarSearch (expanded only)
│   │   └── Input with search icon
│   ├── SidebarNav
│   │   ├── NavItem: Dashboard (BarChart3 icon) — active state
│   │   ├── NavItem: Map (Map icon) — disabled/placeholder
│   │   └── NavItem: Farmers and Enumerators (Users icon) — disabled/placeholder
│   ├── Spacer (flex-1)
│   └── SidebarFooter
│       ├── NavItem: Support (HelpCircle icon) — expanded only
│       └── NavItem: Settings (Settings icon)
```

### 4.3 Nav item component

**File: `frontend/src/components/sidebar-nav-item.js`**

- Props: `{ icon, label, href, isActive, isCollapsed }`
- Expanded: icon + label text
- Collapsed: icon only, wrapped in `Tooltip` for accessibility
- Active state: lighter background (`bg-sidebar-accent`)
- Uses Next.js `Link` for navigation

### 4.4 Responsive behavior
- **Desktop (>=1024px)**: Sidebar visible, starts expanded, collapsible via toggle
- **Tablet (768-1023px)**: Sidebar collapsed by default (icon-only)
- **Mobile (<768px)**: Sidebar hidden, accessible via hamburger menu → `Sheet` (slide-over from left)

**Files created in Phase 4:**
- `frontend/src/app/dashboard/layout.js`
- `frontend/src/components/app-sidebar.js`
- `frontend/src/components/sidebar-nav-item.js`

---

## Phase 5: Dashboard Page — Stats, Filters, Submissions Table

### 5.1 Dashboard page

**File: `frontend/src/app/dashboard/page.js`** (server component shell)
**File: `frontend/src/app/dashboard/dashboard-content.js`** (client component)

```
DashboardPage
└── DashboardContent (client component)
    ├── DashboardHeader
    │   ├── Title: "African Bamboo - Carbon Sequestration Dashboard"
    │   ├── Subtitle: "Digital MRV Data Monitoring & Verification"
    │   └── Button: "+ Add data" (primary/gold)
    ├── StatsCardsRow
    │   ├── StatCard: Target capacity — 20,420
    │   ├── StatCard: Current progress — 210
    │   ├── StatCard: 2026 Target — 1,000
    │   └── StatCard: Carbon potential — 1,000
    ├── FilterBar
    │   ├── Select: Region (left)
    │   └── DateRangeGroup (right)
    │       ├── Select: "Last 7 days"
    │       ├── DateDisplay: "Jan 24 - Feb 24 2023"
    │       └── Button: "Reset"
    ├── FormSectionHeader
    │   ├── Title: form name (from API)
    │   ├── Badge: "240 Data points"
    │   ├── Description
    │   └── Button: "Export data" (outline)
    ├── TableControls
    │   ├── Tabs: View all | Approved | On hold | Rejected
    │   └── SearchInput (right)
    └── SubmissionsTable
        ├── TableHeader (sortable columns)
        ├── TableBody (rows from API data)
        └── TablePagination: Previous | Page X of Y | Next
```

### 5.2 Stat card component

**File: `frontend/src/components/stat-card.js`**

Uses shadcn/ui `Card`. Props: `{ title, value, subtitle, onMenuClick }`.

```
Card (border, rounded)
├── CardHeader (flex row, justify-between)
│   ├── <span> title (muted text, small)
│   └── DropdownMenu (3-dot icon)
└── CardContent
    ├── <div> value (text-3xl font-bold)
    └── <p> subtitle (muted, small)
```

### 5.3 Submissions table component

**File: `frontend/src/components/submissions-table.js`**

Uses shadcn/ui `Table`, `TableHeader`, `TableBody`, `TableRow`, `TableCell`, `TableHead`, `Badge`, `Skeleton`.

**Columns (matching mockup):**
| Column | Source Field | Notes |
|--------|-------------|-------|
| Checkbox | — | Row selection for bulk actions |
| Plot name | `instance_name` | Name + secondary text |
| Status | derived from `raw_data` | Badge: Approved (green), On hold (yellow), Rejected (red) |
| Start date | `raw_data` field | Formatted date |
| End date | `raw_data` field | Formatted date |
| Enumerator | `submitted_by` | Name + phone |
| Region | `raw_data` field | Region name |
| Woreda | `raw_data` field | Sub-region |
| Open Area GeoMapping | `raw_data` field | Coordinates |
| Title Deed | `raw_data` field | Link/icon |

**Data flow:**
1. `useSubmissions` hook fetches `GET /api/v1/odk/submissions/?asset_uid=X&limit=10&offset=Y`
2. Pagination driven by `count` from API response + local `offset` state
3. Status tab filtering done client-side (or via query param if backend supports it)
4. Search filters `instance_name` client-side within loaded page

### 5.4 Table pagination component

**File: `frontend/src/components/table-pagination.js`**

Props: `{ currentPage, totalPages, onPageChange }`

```
<div className="flex items-center justify-between">
  <Button variant="outline" disabled={page===1}>Previous</Button>
  <span>Page {current} of {total}</span>
  <Button variant="outline" disabled={page===total}>Next</Button>
</div>
```

### 5.5 Status badge component

**File: `frontend/src/components/status-badge.js`**

Uses shadcn/ui `Badge` with variant mapping:
- `approved` → green background, green text
- `on_hold` → yellow background, yellow text
- `rejected` → red background, red text

Accessibility: includes icon + text (not color-only indication).

**Files created in Phase 5:**
- `frontend/src/app/dashboard/page.js`
- `frontend/src/app/dashboard/dashboard-content.js`
- `frontend/src/components/stat-card.js`
- `frontend/src/components/submissions-table.js`
- `frontend/src/components/table-pagination.js`
- `frontend/src/components/status-badge.js`
- `frontend/src/components/filter-bar.js`
- `frontend/src/components/dashboard-header.js`

---

## Phase 6: Root Layout & Routing Updates

### 6.1 Update root layout

**File: `frontend/src/app/layout.js`** (modify existing)

- Update `metadata` title/description
- Keep Geist fonts
- Add `suppressHydrationWarning` to `<html>`

### 6.2 Root page redirect

**File: `frontend/src/app/page.js`** (modify existing)

- Replace default Next.js content with redirect to `/dashboard`
- Uses `redirect()` from `next/navigation`

### 6.3 Update tests

**File: `frontend/__tests__/page.test.js`** (modify existing)

- Update to reflect new page structure

---

## Component Hierarchy (Complete)

```
RootLayout (layout.js)
├── /login → LoginPage (server component)
│   └── LoginForm (client: useActionState + login Server Action)
│
├── /dashboard → DashboardLayout (server: verifySession → passes user+token)
│   ├── AuthProvider (client: receives user+token, configures axios)
│   ├── AppSidebar
│   │   ├── SidebarHeader (Logo)
│   │   ├── SidebarNav
│   │   │   └── SidebarNavItem (x3: Dashboard, Map, Farmers)
│   │   └── SidebarFooter (Support, Settings)
│   └── <main>
│       └── /dashboard (index) → DashboardPage
│           └── DashboardContent
│               ├── DashboardHeader (title + Add data button)
│               ├── StatsCardsRow
│               │   └── StatCard (x4)
│               ├── FilterBar (Region select + date range + reset)
│               ├── FormSectionHeader (form name + badge + export)
│               ├── TableControls (Tabs + SearchInput)
│               ├── SubmissionsTable
│               │   ├── TableHeader (sortable)
│               │   ├── TableBody → TableRow (per submission)
│               │   │   └── StatusBadge
│               │   └── Skeleton (loading state)
│               └── TablePagination
```

---

## State Management

| State | Location | Persistence |
|-------|----------|-------------|
| Auth session (user, token) | jose-encrypted httpOnly cookie (`session`) | Cookie (12h expiry) |
| Auth context (client) | `AuthContext` — receives user+token from server | In-memory (per page load) |
| Sidebar collapsed | `useState` in DashboardLayout | None (resets on nav) |
| Current page/offset | `useState` in DashboardContent | URL search params (optional) |
| Active status tab | `useState` in DashboardContent | None |
| Search query | `useState` in DashboardContent | None |
| Submissions data | `useSubmissions` hook (fetch-on-mount + on param change) | None (refetched) |
| Forms list | `useForms` hook | None |

---

## Accessibility Strategy

| Concern | Implementation |
|---------|---------------|
| **Keyboard navigation** | All interactive elements focusable; Tab order matches visual layout; Radix primitives handle this |
| **Focus management** | Focus moves to error on form failure; Skip-to-content link in layout |
| **Screen readers** | `aria-label` on icon-only buttons; `role="alert"` for errors; `aria-live="polite"` for status updates |
| **Color contrast** | 4.5:1 minimum; status badges use icon+text, not color alone |
| **Form labels** | Every `Input` has associated `Label` via `htmlFor` |
| **Table a11y** | Proper `<table>` semantics via shadcn Table; `scope="col"` on headers |
| **Reduced motion** | Respect `prefers-reduced-motion` for transitions |
| **Sidebar tooltips** | Collapsed nav items show `Tooltip` with label text |

---

## Responsive Design Strategy

| Breakpoint | Sidebar | Table | Stats Cards | Layout |
|------------|---------|-------|-------------|--------|
| **Mobile (<768px)** | Hidden; hamburger → Sheet | Horizontal scroll (`overflow-x-auto`) | 2-column grid or stacked | Single column |
| **Tablet (768-1023px)** | Collapsed (icons only) | Horizontal scroll, key columns visible | 2x2 grid | Sidebar + main |
| **Desktop (>=1024px)** | Expanded (icons + labels) | Full table, all columns | 4-column row | Sidebar + main |

---

## File Summary (All files to create/modify)

| Action | Path | Purpose |
|--------|------|---------|
| Generate | `frontend/components.json` | shadcn/ui config |
| Generate | `frontend/src/lib/utils.js` | `cn()` utility |
| Generate | `frontend/src/components/ui/*.js` | shadcn components (button, input, etc.) |
| Modify | `frontend/src/app/globals.css` | Tailwind v4 theming with CSS variables |
| Modify | `frontend/src/app/layout.js` | Update metadata, fonts |
| Modify | `frontend/src/app/page.js` | Root redirect to /dashboard |
| Copy | `frontend/public/logo.svg` | Sidebar logo asset |
| Create | `frontend/.env` | SESSION_SECRET |
| Create | `frontend/src/lib/session.js` | jose encrypt/decrypt, cookie management |
| Create | `frontend/src/lib/dal.js` | verifySession (server-side DAL) |
| Create | `frontend/src/lib/api.js` | Axios client for client-side fetching |
| Create | `frontend/src/app/actions/auth.js` | login/logout Server Actions |
| Create | `frontend/src/middleware.js` | Route protection (cookie check) |
| Create | `frontend/src/context/AuthContext.js` | Client-side user+token context |
| Create | `frontend/src/hooks/useAuth.js` | Context wrapper hook |
| Create | `frontend/src/hooks/useSubmissions.js` | Submissions data fetching hook |
| Create | `frontend/src/hooks/useForms.js` | Forms data fetching hook |
| Create | `frontend/src/app/login/page.js` | Login page (server component) |
| Create | `frontend/src/app/login/login-form.js` | Login form (client, useActionState) |
| Create | `frontend/src/app/dashboard/layout.js` | Dashboard layout (server, verifySession) |
| Create | `frontend/src/app/dashboard/page.js` | Dashboard page (server shell) |
| Create | `frontend/src/app/dashboard/dashboard-content.js` | Dashboard content (client) |
| Create | `frontend/src/components/app-sidebar.js` | Collapsible sidebar nav |
| Create | `frontend/src/components/sidebar-nav-item.js` | Sidebar nav item |
| Create | `frontend/src/components/stat-card.js` | Stats card component |
| Create | `frontend/src/components/submissions-table.js` | Data table with columns |
| Create | `frontend/src/components/table-pagination.js` | Pagination controls |
| Create | `frontend/src/components/status-badge.js` | Status badge (approved/on hold/rejected) |
| Create | `frontend/src/components/filter-bar.js` | Region + date range filters |
| Create | `frontend/src/components/dashboard-header.js` | Page header with title + add button |
| Modify | `frontend/__tests__/page.test.js` | Update for new root page |
| Create | `frontend/__tests__/login-form.test.js` | Login form tests |
| Create | `frontend/__tests__/submissions-table.test.js` | Submissions table tests |
| Modify | `frontend/package.json` | jose, server-only, shadcn deps |

---

## Verification Plan

### Manual testing
1. `docker-compose up` → visit `http://localhost:3000`
2. Redirected to `/login` (unauthenticated)
3. Enter invalid credentials → see error message
4. Enter valid KoboToolbox credentials → redirected to `/dashboard`
5. Dashboard shows sidebar, stats cards, table with data
6. Click sidebar toggle → collapses/expands
7. Change page in table → data updates
8. Click status tabs → table filters
9. Resize browser → responsive layout changes
10. Navigate directly to `/dashboard` without token → redirected to `/login`

### Automated tests
```bash
cd frontend
yarn test         # Jest + Testing Library
yarn lint         # ESLint
yarn build        # Verify production build succeeds
```

### Accessibility audit
- Run Lighthouse accessibility audit in Chrome DevTools
- Tab through login form and dashboard — verify focus visibility
- Test with screen reader (VoiceOver / NVDA)

---

## Implementation Order

1. **Phase 1** — shadcn/ui init, theming, logo asset
2. **Phase 2** — Session lib, Server Actions, DAL, middleware, API client, context, hooks
3. **Phase 3** — Login page with form
4. **Phase 4** — Dashboard layout with sidebar
5. **Phase 5** — Dashboard content: stats, filters, table
6. **Phase 6** — Root routing updates, tests
